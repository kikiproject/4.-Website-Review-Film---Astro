---
interface Props {
  id: number;
  title: string;
  posterPath: string | null;
  releaseDate?: string;
  voteAverage: number;
  genreIds?: number[];
  size?: 'small' | 'medium' | 'large';
  showRating?: boolean;
}

const { 
  id, 
  title, 
  posterPath, 
  releaseDate, 
  voteAverage, 
  genreIds = [],
  size = 'medium',
  showRating = true
} = Astro.props;

const imageBaseUrl = 'https://image.tmdb.org/t/p';
// Support both full URL and path-only formats
const posterUrl = posterPath 
  ? (posterPath.startsWith('http') ? posterPath : `${imageBaseUrl}/w342${posterPath}`)
  : '/images/default-poster.png';

const year = releaseDate ? new Date(releaseDate).getFullYear() : null;
const rating = Math.round(voteAverage * 10) / 10;

const getRatingClass = (rating: number) => {
  if (rating >= 7) return 'rating-high';
  if (rating >= 5) return 'rating-medium';
  return 'rating-low';
};

const sizeClasses = {
  small: 'w-28 sm:w-32',
  medium: 'w-36 sm:w-44',
  large: 'w-44 sm:w-52',
};
---

<a href={`/film/${id}`} class={`movie-card block ${sizeClasses[size]}`}>
  <div class="poster">
    <img 
      src={posterUrl} 
      alt={title}
      loading="lazy"
      class="w-full h-full object-cover"
    />
    
    <!-- Overlay with actions -->
    <div class="overlay flex flex-col items-center justify-end p-4">
      <div class="flex items-center gap-2 mb-2">
        <button 
          class="p-2 bg-dark-500/80 rounded-full text-white hover:bg-primary-500 transition-all duration-300"
          data-watchlist={id}
          aria-label="Tambah ke Watchlist"
        >
          <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 5a2 2 0 012-2h10a2 2 0 012 2v16l-7-3.5L5 21V5z"/>
          </svg>
        </button>
        <button 
          class="p-2 bg-dark-500/80 rounded-full text-white hover:bg-magenta-500 transition-all duration-300"
          data-favorite={id}
          aria-label="Tambah ke Favorit"
        >
          <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"/>
          </svg>
        </button>
      </div>
      <span class="text-white text-sm font-medium bg-dark-500/80 px-3 py-1 rounded-full">
        Lihat Detail
      </span>
    </div>

    <!-- Rating Badge -->
    {showRating && (
      <div class={`absolute top-2 right-2 ${getRatingClass(rating)} w-10 h-10 text-xs`}>
        {rating}
      </div>
    )}
  </div>

  <div class="info">
    <h3 class="text-white font-medium text-sm line-clamp-2 mb-1 group-hover:text-primary-400 transition-colors">
      {title}
    </h3>
    {year && (
      <p class="text-secondary-500 text-xs">{year}</p>
    )}
  </div>
</a>

<style>
  .movie-card:hover .poster img {
    transform: scale(1.05);
  }
</style>
