---
const genres = [
  { id: 28, name: 'Action' },
  { id: 12, name: 'Adventure' },
  { id: 16, name: 'Animation' },
  { id: 35, name: 'Comedy' },
  { id: 80, name: 'Crime' },
  { id: 18, name: 'Drama' },
  { id: 14, name: 'Fantasy' },
  { id: 27, name: 'Horror' },
  { id: 10749, name: 'Romance' },
  { id: 878, name: 'Sci-Fi' },
  { id: 53, name: 'Thriller' },
];
---

<div id="search-modal" class="hidden fixed inset-0 z-[100]">
  <!-- Overlay -->
  <div class="absolute inset-0 bg-black/80 backdrop-blur-md" id="search-overlay"></div>
  
  <!-- Modal Content -->
  <div class="relative flex flex-col h-full max-w-4xl mx-auto p-4 pt-8 md:pt-16">
    <!-- Close Button -->
    <button 
      id="search-close"
      class="absolute top-4 right-4 p-2 text-secondary-400 hover:text-white transition-colors"
      aria-label="Tutup pencarian"
    >
      <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
      </svg>
    </button>

    <!-- Search Header -->
    <div class="mb-8">
      <h2 class="text-2xl md:text-3xl font-display font-bold text-white mb-2">
        Cari Film
      </h2>
      <p class="text-secondary-400">
        Temukan film, series, atau anime favoritmu
      </p>
    </div>

    <!-- Search Input -->
    <div class="relative mb-6">
      <input 
        type="text"
        id="search-input"
        placeholder="Ketik judul film, anime, atau series..."
        class="input-search text-lg py-4"
        autocomplete="off"
      />
      <svg class="absolute left-4 top-1/2 -translate-y-1/2 w-6 h-6 text-secondary-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/>
      </svg>
      <div id="search-loading" class="hidden absolute right-4 top-1/2 -translate-y-1/2">
        <svg class="animate-spin w-5 h-5 text-primary-400" fill="none" viewBox="0 0 24 24">
          <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
          <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
        </svg>
      </div>
    </div>

    <!-- Quick Filters -->
    <div class="flex flex-wrap gap-2 mb-6">
      <button class="badge-primary cursor-pointer hover:bg-primary-500/30 transition-colors" data-type="movie">
        ðŸŽ¬ Film
      </button>
      <button class="badge-violet cursor-pointer hover:bg-violet-500/30 transition-colors" data-type="anime">
        ðŸŽŒ Anime
      </button>
      <button class="badge-magenta cursor-pointer hover:bg-magenta-500/30 transition-colors" data-type="series">
        ðŸ“º Series
      </button>
    </div>

    <!-- Genre Quick Links -->
    <div class="mb-6">
      <h3 class="text-sm font-medium text-secondary-400 mb-3">Genre Populer</h3>
      <div class="flex flex-wrap gap-2">
        {genres.map((genre) => (
          <a 
            href={`/genre/${genre.id}`}
            class="px-3 py-1.5 bg-dark-300 text-secondary-300 text-sm rounded-lg hover:bg-dark-200 hover:text-white transition-all duration-300"
          >
            {genre.name}
          </a>
        ))}
      </div>
    </div>

    <!-- Search Results -->
    <div id="search-results" class="flex-1 overflow-auto hide-scrollbar">
      <!-- Default: Search History -->
      <div id="search-history" class="mb-6">
        <div class="flex items-center justify-between mb-3">
          <h3 class="text-sm font-medium text-secondary-400">Pencarian Terakhir</h3>
          <button id="clear-history" class="text-xs text-secondary-500 hover:text-primary-400 transition-colors">
            Hapus Semua
          </button>
        </div>
        <div id="history-list" class="flex flex-wrap gap-2">
          <!-- History items will be rendered here -->
          <span class="text-secondary-500 text-sm">Belum ada pencarian</span>
        </div>
      </div>

      <!-- Trending Searches -->
      <div id="trending-searches">
        <h3 class="text-sm font-medium text-secondary-400 mb-3">ðŸ”¥ Trending</h3>
        <div class="grid grid-cols-2 md:grid-cols-3 gap-2">
          <a href="/film/123" class="flex items-center gap-3 p-3 bg-dark-300/50 rounded-xl hover:bg-dark-200 transition-all duration-300">
            <span class="text-primary-400 font-bold">1</span>
            <span class="text-white text-sm">Dune: Part Two</span>
          </a>
          <a href="/film/456" class="flex items-center gap-3 p-3 bg-dark-300/50 rounded-xl hover:bg-dark-200 transition-all duration-300">
            <span class="text-primary-400 font-bold">2</span>
            <span class="text-white text-sm">Oppenheimer</span>
          </a>
          <a href="/film/789" class="flex items-center gap-3 p-3 bg-dark-300/50 rounded-xl hover:bg-dark-200 transition-all duration-300">
            <span class="text-primary-400 font-bold">3</span>
            <span class="text-white text-sm">Spider-Man</span>
          </a>
        </div>
      </div>

      <!-- Search Results Container -->
      <div id="results-container" class="hidden">
        <h3 class="text-sm font-medium text-secondary-400 mb-3">Hasil Pencarian</h3>
        <div id="results-list" class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-4">
          <!-- Results will be rendered here -->
        </div>
      </div>
    </div>

    <!-- Advanced Search Link -->
    <div class="pt-4 border-t border-dark-100">
      <a href="/pencarian" class="flex items-center justify-center gap-2 text-primary-400 hover:text-primary-300 transition-colors">
        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6V4m0 2a2 2 0 100 4m0-4a2 2 0 110 4m-6 8a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4m6 6v10m6-2a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4"/>
        </svg>
        Pencarian Lanjutan
      </a>
    </div>
  </div>
</div>

<script>
  const searchModal = document.getElementById('search-modal');
  const searchOverlay = document.getElementById('search-overlay');
  const searchClose = document.getElementById('search-close');
  const searchInput = document.getElementById('search-input') as HTMLInputElement;

  // Close modal
  function closeSearchModal() {
    searchModal?.classList.add('hidden');
    if (searchInput) searchInput.value = '';
  }

  searchOverlay?.addEventListener('click', closeSearchModal);
  searchClose?.addEventListener('click', closeSearchModal);

  // Close on escape key
  document.addEventListener('keydown', (e) => {
    if (e.key === 'Escape' && !searchModal?.classList.contains('hidden')) {
      closeSearchModal();
    }
  });

  // Search input handler with debounce
  let searchTimeout: ReturnType<typeof setTimeout>;
  searchInput?.addEventListener('input', (e) => {
    const query = (e.target as HTMLInputElement).value;
    
    clearTimeout(searchTimeout);
    
    if (query.length < 2) {
      // Show default content
      document.getElementById('search-history')?.classList.remove('hidden');
      document.getElementById('trending-searches')?.classList.remove('hidden');
      document.getElementById('results-container')?.classList.add('hidden');
      return;
    }

    // Show loading
    document.getElementById('search-loading')?.classList.remove('hidden');

    searchTimeout = setTimeout(async () => {
      // Perform search
      try {
        // API call would go here
        // const results = await searchMovies(query);
        
        // Hide default content, show results
        document.getElementById('search-history')?.classList.add('hidden');
        document.getElementById('trending-searches')?.classList.add('hidden');
        document.getElementById('results-container')?.classList.remove('hidden');
        
      } catch (error) {
        console.error('Search error:', error);
      } finally {
        document.getElementById('search-loading')?.classList.add('hidden');
      }
    }, 300);
  });
</script>
