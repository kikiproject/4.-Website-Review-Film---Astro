---
import MainLayout from '../layouts/MainLayout.astro';
import HeroSliderNew from '../components/HeroSliderNew.astro';
import MovieSlider from '../components/MovieSlider.astro';
import { Icon } from '@iconify/react';
import { getTrendingMovies, getPopularMovies, getNowPlayingMovies, getUpcomingMovies, getTopRatedMovies } from '../lib/tmdb';

// Fetch real-time data from TMDB API
let trendingMovies: any[] = [];
let popularMovies: any[] = [];
let nowPlayingMovies: any[] = [];
let upcomingMovies: any[] = [];
let topRatedMovies: any[] = [];

try {
  const [trending, popular, nowPlaying, upcoming, topRated] = await Promise.all([
    getTrendingMovies('week', 1),
    getPopularMovies(1),
    getNowPlayingMovies(1),
    getUpcomingMovies(1),
    getTopRatedMovies(1)
  ]);
  
  trendingMovies = trending.results.slice(0, 6);
  popularMovies = popular.results.slice(0, 12);
  nowPlayingMovies = nowPlaying.results.slice(0, 8);
  upcomingMovies = upcoming.results.slice(0, 8);
  topRatedMovies = topRated.results.slice(0, 6);
} catch (error) {
  console.error('Error fetching movies:', error);
}

// Category data with icons
const categories = [
  { href: '/film', icon: 'lucide:clapperboard', label: 'Semua Film', active: true },
  { href: '/anime', icon: 'lucide:sparkles', label: 'Anime', active: false },
  { href: '/series', icon: 'lucide:tv', label: 'Series', active: false },
  { href: '/bioskop', icon: 'lucide:film', label: 'Bioskop', active: false },
  { href: '/mendatang', icon: 'lucide:calendar-clock', label: 'Akan Datang', active: false },
  { href: '/trending', icon: 'lucide:trending-up', label: 'Trending', active: false },
  { href: '/top-rated', icon: 'lucide:award', label: 'Top Rated', active: false },
];

// Features data
const features = [
  { 
    icon: 'lucide:film', 
    title: 'Koleksi Lengkap', 
    desc: '10,000+ film dari berbagai genre',
    color: 'from-blue-500 to-cyan-500'
  },
  { 
    icon: 'lucide:users', 
    title: 'Nonton Bareng', 
    desc: 'Watch party dengan VTuber host',
    color: 'from-violet-500 to-purple-500'
  },
  { 
    icon: 'lucide:message-circle', 
    title: 'Live Chat', 
    desc: 'Diskusi real-time dengan komunitas',
    color: 'from-pink-500 to-rose-500'
  },
  { 
    icon: 'lucide:star', 
    title: 'Review & Rating', 
    desc: 'Baca dan tulis review film',
    color: 'from-amber-500 to-orange-500'
  },
];
---

<MainLayout title="ASTRO - Website Review Film Indonesia">
  <!-- Hero Slider with Landing Page Design -->
  <HeroSliderNew movies={trendingMovies} />

  <!-- Quick Categories with Animated Icons -->
  <section class="py-10 relative overflow-hidden">
    <!-- Background decoration -->
    <div class="absolute inset-0 bg-gradient-to-b from-dark-500 to-dark-400"></div>
    <div class="absolute top-0 left-0 right-0 h-px bg-gradient-to-r from-transparent via-primary-500/50 to-transparent"></div>
    
    <div class="container-custom relative">
      <div class="flex items-center gap-4 overflow-x-auto hide-scrollbar pb-2 px-2">
        {categories.map((cat, index) => (
          <a 
            href={cat.href} 
            class={`group flex-shrink-0 flex items-center gap-3 px-6 py-3.5 rounded-2xl font-medium transition-all duration-300 hover:scale-105 ${
              cat.active 
                ? 'bg-gradient-to-r from-primary-500 to-violet-500 text-white shadow-lg shadow-primary-500/25' 
                : 'bg-dark-300/50 text-secondary-300 hover:bg-dark-200 hover:text-white border border-dark-100 hover:border-primary-500/30'
            }`}
            style={`animation: fade-in-up 0.5s ease-out ${index * 0.1}s forwards; opacity: 0;`}
          >
            <Icon 
              icon={cat.icon} 
              class={`w-5 h-5 transition-transform duration-300 group-hover:scale-110 ${cat.active ? 'text-white' : 'text-primary-400'}`} 
              client:load 
            />
            <span>{cat.label}</span>
          </a>
        ))}
      </div>
    </div>
  </section>

  <!-- Features Showcase -->
  <section class="py-16 relative overflow-hidden">
    <div class="absolute inset-0 bg-[radial-gradient(ellipse_at_center,rgba(139,92,246,0.1),transparent_70%)]"></div>
    
    <div class="container-custom relative">
      <div class="grid grid-cols-2 lg:grid-cols-4 gap-4 md:gap-6">
        {features.map((feature, index) => (
          <div 
            class="group relative p-6 rounded-2xl bg-dark-400/50 backdrop-blur-sm border border-dark-100 hover:border-primary-500/30 transition-all duration-500 hover:-translate-y-2 hover:shadow-xl hover:shadow-primary-500/10"
            style={`animation: fade-in-up 0.6s ease-out ${index * 0.15}s forwards; opacity: 0;`}
          >
            <!-- Glow effect -->
            <div class={`absolute -inset-px rounded-2xl bg-gradient-to-r ${feature.color} opacity-0 group-hover:opacity-10 transition-opacity blur-xl`}></div>
            
            <div class="relative">
              <div class={`w-14 h-14 rounded-xl bg-gradient-to-br ${feature.color} flex items-center justify-center mb-4 shadow-lg transform group-hover:scale-110 group-hover:rotate-3 transition-all duration-300`}>
                <Icon icon={feature.icon} class="w-7 h-7 text-white" client:load />
              </div>
              <h3 class="text-lg font-bold text-white mb-1 group-hover:text-primary-400 transition-colors">{feature.title}</h3>
              <p class="text-secondary-400 text-sm">{feature.desc}</p>
            </div>
          </div>
        ))}
      </div>
    </div>
  </section>

  <!-- Popular Movies Section with Custom Header -->
  <section class="py-12 relative">
    <div class="container-custom">
      <div class="flex items-end justify-between mb-8">
        <div class="flex items-center gap-4">
          <div class="w-12 h-12 rounded-xl bg-gradient-to-br from-orange-500 to-red-500 flex items-center justify-center shadow-lg shadow-orange-500/25">
            <Icon icon="lucide:flame" class="w-6 h-6 text-white" client:load />
          </div>
          <div>
            <h2 class="text-2xl md:text-3xl font-display font-bold text-white">Film Terpopuler</h2>
            <p class="text-secondary-400">Film yang sedang banyak dibicarakan</p>
          </div>
        </div>
        <a href="/film/populer" class="group flex items-center gap-2 text-primary-400 hover:text-primary-300 font-medium transition-colors">
          Lihat Semua
          <Icon icon="lucide:arrow-right" class="w-5 h-5 group-hover:translate-x-1 transition-transform" client:load />
        </a>
      </div>
    </div>
    <MovieSlider 
      movies={popularMovies}
      viewAllLink="/film/populer"
      showHeader={false}
    />
  </section>

  <!-- Now Playing Section -->
  <section class="py-12 relative">
    <div class="container-custom">
      <div class="flex items-end justify-between mb-8">
        <div class="flex items-center gap-4">
          <div class="w-12 h-12 rounded-xl bg-gradient-to-br from-green-500 to-emerald-500 flex items-center justify-center shadow-lg shadow-green-500/25 relative">
            <Icon icon="lucide:clapperboard" class="w-6 h-6 text-white" client:load />
            <span class="absolute -top-1 -right-1 w-3 h-3 bg-red-500 rounded-full animate-pulse"></span>
          </div>
          <div>
            <h2 class="text-2xl md:text-3xl font-display font-bold text-white">Sedang Tayang</h2>
            <p class="text-secondary-400">Tonton sekarang di bioskop terdekat</p>
          </div>
        </div>
        <a href="/bioskop" class="group flex items-center gap-2 text-primary-400 hover:text-primary-300 font-medium transition-colors">
          Lihat Semua
          <Icon icon="lucide:arrow-right" class="w-5 h-5 group-hover:translate-x-1 transition-transform" client:load />
        </a>
      </div>
    </div>
    <MovieSlider 
      movies={nowPlayingMovies}
      viewAllLink="/bioskop"
      showHeader={false}
    />
  </section>

  <!-- Upcoming Movies Section -->
  <section class="py-12 relative">
    <div class="container-custom">
      <div class="flex items-end justify-between mb-8">
        <div class="flex items-center gap-4">
          <div class="w-12 h-12 rounded-xl bg-gradient-to-br from-blue-500 to-indigo-500 flex items-center justify-center shadow-lg shadow-blue-500/25">
            <Icon icon="lucide:calendar" class="w-6 h-6 text-white" client:load />
          </div>
          <div>
            <h2 class="text-2xl md:text-3xl font-display font-bold text-white">Film Mendatang</h2>
            <p class="text-secondary-400">Film yang akan segera tayang</p>
          </div>
        </div>
        <a href="/mendatang" class="group flex items-center gap-2 text-primary-400 hover:text-primary-300 font-medium transition-colors">
          Lihat Semua
          <Icon icon="lucide:arrow-right" class="w-5 h-5 group-hover:translate-x-1 transition-transform" client:load />
        </a>
      </div>
    </div>
    <MovieSlider 
      movies={upcomingMovies}
      viewAllLink="/mendatang"
      showHeader={false}
    />
  </section>

  <!-- Top Rated Section -->
  <section class="py-12 relative">
    <div class="container-custom">
      <div class="flex items-end justify-between mb-8">
        <div class="flex items-center gap-4">
          <div class="w-12 h-12 rounded-xl bg-gradient-to-br from-yellow-500 to-amber-500 flex items-center justify-center shadow-lg shadow-yellow-500/25">
            <Icon icon="lucide:trophy" class="w-6 h-6 text-white" client:load />
          </div>
          <div>
            <h2 class="text-2xl md:text-3xl font-display font-bold text-white">Rating Tertinggi</h2>
            <p class="text-secondary-400">Film terbaik sepanjang masa</p>
          </div>
        </div>
        <a href="/top-rated" class="group flex items-center gap-2 text-primary-400 hover:text-primary-300 font-medium transition-colors">
          Lihat Semua
          <Icon icon="lucide:arrow-right" class="w-5 h-5 group-hover:translate-x-1 transition-transform" client:load />
        </a>
      </div>
    </div>
    <MovieSlider 
      movies={topRatedMovies}
      viewAllLink="/top-rated"
      showHeader={false}
    />
  </section>

  <!-- Editor's Pick Section -->
  <section class="py-16 relative overflow-hidden">
    <!-- Background effects -->
    <div class="absolute inset-0 bg-gradient-to-b from-transparent via-primary-900/5 to-transparent"></div>
    
    <div class="container-custom relative">
      <div class="flex items-center gap-4 mb-10">
        <div class="w-12 h-12 rounded-xl bg-gradient-to-br from-violet-500 to-purple-500 flex items-center justify-center shadow-lg shadow-violet-500/25">
          <Icon icon="lucide:sparkles" class="w-6 h-6 text-white" client:load />
        </div>
        <div>
          <h2 class="text-2xl md:text-3xl font-display font-bold text-white">Pilihan Editor</h2>
          <p class="text-secondary-400">Rekomendasi terbaik dari tim ASTRO</p>
        </div>
      </div>

      {trendingMovies.length >= 3 && (
      <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
        <!-- Featured Main -->
        <a href={`/film/${trendingMovies[0].id}`} class="group lg:col-span-2 relative aspect-video lg:aspect-[16/9] rounded-3xl overflow-hidden">
          <img 
            src={`https://image.tmdb.org/t/p/w1280${trendingMovies[0].backdropPath}`}
            alt={trendingMovies[0].title}
            class="w-full h-full object-cover transition-transform duration-700 group-hover:scale-110"
          />
          <div class="absolute inset-0 bg-gradient-to-t from-dark-500 via-dark-500/50 to-transparent"></div>
          
          <!-- Content -->
          <div class="absolute bottom-0 left-0 right-0 p-8">
            <div class="flex items-center gap-3 mb-4">
              <span class="px-4 py-1.5 bg-gradient-to-r from-primary-500 to-violet-500 rounded-full text-white text-sm font-bold flex items-center gap-2">
                <Icon icon="lucide:crown" class="w-4 h-4" client:load />
                Editor's Choice
              </span>
              <span class="px-3 py-1.5 bg-yellow-500/20 rounded-full text-yellow-400 text-sm font-bold flex items-center gap-1.5">
                <Icon icon="lucide:star" class="w-4 h-4 fill-current" client:load />
                {trendingMovies[0].voteAverage?.toFixed(1)}
              </span>
            </div>
            <h3 class="text-3xl md:text-4xl font-display font-bold text-white mb-3 group-hover:text-primary-400 transition-colors">{trendingMovies[0].title}</h3>
            <p class="text-secondary-300 line-clamp-2 max-w-2xl">{trendingMovies[0].overview}</p>
          </div>
          
          <!-- Play button -->
          <div class="absolute inset-0 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity">
            <div class="w-20 h-20 rounded-full bg-white/20 backdrop-blur-md flex items-center justify-center border border-white/30">
              <Icon icon="lucide:play" class="w-10 h-10 text-white fill-white ml-1" client:load />
            </div>
          </div>
        </a>

        <!-- Side cards -->
        <div class="flex flex-col gap-6">
          {trendingMovies.slice(1, 3).map((movie) => (
            <a href={`/film/${movie.id}`} class="group relative flex-1 rounded-2xl overflow-hidden min-h-[200px]">
              <img 
                src={`https://image.tmdb.org/t/p/w780${movie.backdropPath}`}
                alt={movie.title}
                class="absolute inset-0 w-full h-full object-cover transition-transform duration-500 group-hover:scale-110"
              />
              <div class="absolute inset-0 bg-gradient-to-t from-dark-500 via-dark-500/60 to-transparent"></div>
              
              <div class="absolute bottom-0 left-0 right-0 p-5">
                <div class="flex items-center gap-2 mb-2">
                  <span class="text-yellow-400 text-sm font-bold flex items-center gap-1">
                    <Icon icon="lucide:star" class="w-4 h-4 fill-current" client:load />
                    {movie.voteAverage?.toFixed(1)}
                  </span>
                  <span class="text-secondary-400 text-sm">{movie.releaseDate?.slice(0, 4)}</span>
                </div>
                <h3 class="text-lg font-bold text-white group-hover:text-primary-400 transition-colors line-clamp-1">{movie.title}</h3>
              </div>
            </a>
          ))}
        </div>
      </div>
      )}
    </div>
  </section>

  <!-- CTA Section - Watch Party -->
  <section class="py-20 relative overflow-hidden">
    <!-- Animated background -->
    <div class="absolute inset-0 bg-gradient-to-br from-primary-900/30 via-dark-500 to-violet-900/30"></div>
    <div class="absolute inset-0">
      <div class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-[800px] h-[800px] bg-primary-500/10 rounded-full blur-[150px] animate-pulse-slow"></div>
    </div>
    
    <div class="container-custom relative">
      <div class="max-w-4xl mx-auto text-center">
        <div class="inline-flex items-center gap-2 px-5 py-2 bg-primary-500/20 rounded-full text-primary-400 text-sm font-bold mb-6 border border-primary-500/30">
          <Icon icon="lucide:users" class="w-4 h-4" client:load />
          Fitur Baru
        </div>
        
        <h2 class="text-4xl md:text-5xl lg:text-6xl font-display font-bold text-white mb-6 leading-tight">
          Nonton Film Bareng
          <span class="block mt-2 text-transparent bg-clip-text bg-gradient-to-r from-primary-400 via-violet-400 to-magenta-400">
            VTuber Favorit
          </span>
        </h2>
        
        <p class="text-xl text-secondary-300 mb-10 max-w-2xl mx-auto">
          Bergabung dalam watch party dan tonton film bersama komunitas. 
          Sinkronisasi real-time, live chat, dan reaksi bersama!
        </p>
        
        <div class="flex flex-wrap justify-center gap-4">
          <a href="/nonton-bareng" class="group relative px-8 py-4 rounded-2xl overflow-hidden transition-all duration-300 hover:scale-105 hover:shadow-2xl hover:shadow-primary-500/25">
            <span class="absolute inset-0 bg-gradient-to-r from-primary-500 via-violet-500 to-primary-500 bg-[length:200%_100%] animate-gradient-x"></span>
            <span class="relative flex items-center gap-3 text-white font-bold text-lg">
              <Icon icon="lucide:play-circle" class="w-6 h-6" client:load />
              Mulai Nonton Bareng
            </span>
          </a>
          
          <a href="/live-chat" class="px-8 py-4 bg-white/10 backdrop-blur-xl rounded-2xl text-white font-bold text-lg border border-white/20 hover:bg-white/20 hover:scale-105 transition-all duration-300 flex items-center gap-3">
            <Icon icon="lucide:message-square" class="w-6 h-6" client:load />
            Join Live Chat
          </a>
        </div>
      </div>
    </div>
  </section>

  <!-- Newsletter Section -->
  <section class="py-16 relative">
    <div class="container-custom">
      <div class="relative rounded-3xl overflow-hidden p-8 md:p-12">
        <!-- Background -->
        <div class="absolute inset-0 bg-gradient-to-br from-dark-400 via-dark-400 to-dark-300"></div>
        <div class="absolute inset-0 bg-[radial-gradient(ellipse_at_top_right,rgba(139,92,246,0.15),transparent_50%)]"></div>
        <div class="absolute inset-0 bg-[radial-gradient(ellipse_at_bottom_left,rgba(236,72,153,0.1),transparent_50%)]"></div>
        <div class="absolute top-0 left-0 right-0 h-px bg-gradient-to-r from-transparent via-white/20 to-transparent"></div>
        
        <div class="relative max-w-2xl mx-auto text-center space-y-6">
          <div class="w-16 h-16 mx-auto rounded-2xl bg-gradient-to-br from-primary-500 to-violet-500 flex items-center justify-center shadow-lg shadow-primary-500/25">
            <Icon icon="lucide:bell" class="w-8 h-8 text-white" client:load />
          </div>
          
          <h2 class="text-2xl md:text-3xl font-display font-bold text-white">
            Jangan Lewatkan Update Film Terbaru!
          </h2>
          
          <p class="text-secondary-300">
            Dapatkan notifikasi film baru, rekomendasi personal, dan artikel menarik langsung di inbox kamu.
          </p>
          
          <form class="flex flex-col sm:flex-row gap-3 max-w-md mx-auto">
            <div class="relative flex-1">
              <Icon icon="lucide:mail" class="absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 text-secondary-400" client:load />
              <input 
                type="email" 
                placeholder="Masukkan email kamu"
                class="w-full pl-12 pr-4 py-4 bg-dark-500 border border-dark-100 rounded-xl text-white placeholder:text-secondary-500 focus:outline-none focus:border-primary-500 transition-colors"
              />
            </div>
            <button type="submit" class="px-8 py-4 bg-gradient-to-r from-primary-500 to-violet-500 rounded-xl text-white font-bold hover:shadow-lg hover:shadow-primary-500/25 transition-all hover:scale-105 flex items-center justify-center gap-2">
              <Icon icon="lucide:send" class="w-5 h-5" client:load />
              Berlangganan
            </button>
          </form>
          
          <p class="text-xs text-secondary-500">
            Dengan berlangganan, kamu setuju dengan kebijakan privasi kami. Bisa berhenti kapan saja.
          </p>
        </div>
      </div>
    </div>
  </section>

  <!-- Stats Section -->
  <section class="py-16 relative overflow-hidden">
    <div class="absolute inset-0 bg-gradient-to-r from-primary-900/10 via-transparent to-violet-900/10"></div>
    
    <div class="container-custom relative">
      <div class="grid grid-cols-2 md:grid-cols-4 gap-8">
        {[
          { value: '10,000+', label: 'Film & Series', icon: 'lucide:film', color: 'from-blue-500 to-cyan-500' },
          { value: '50,000+', label: 'Review Pengguna', icon: 'lucide:message-square', color: 'from-violet-500 to-purple-500' },
          { value: '100,000+', label: 'Pengguna Aktif', icon: 'lucide:users', color: 'from-pink-500 to-rose-500' },
          { value: '500+', label: 'Genre & Kategori', icon: 'lucide:layers', color: 'from-amber-500 to-orange-500' },
        ].map((stat, index) => (
          <div 
            class="group text-center p-6 rounded-2xl bg-dark-400/30 backdrop-blur-sm border border-dark-100 hover:border-primary-500/30 transition-all duration-300 hover:-translate-y-2"
            style={`animation: fade-in-up 0.6s ease-out ${index * 0.1}s forwards; opacity: 0;`}
          >
            <div class={`w-12 h-12 mx-auto mb-4 rounded-xl bg-gradient-to-br ${stat.color} flex items-center justify-center shadow-lg transform group-hover:scale-110 transition-transform`}>
              <Icon icon={stat.icon} class="w-6 h-6 text-white" client:load />
            </div>
            <div class={`text-3xl md:text-4xl font-display font-bold mb-2 text-transparent bg-clip-text bg-gradient-to-r ${stat.color}`}>
              {stat.value}
            </div>
            <div class="text-secondary-400">{stat.label}</div>
          </div>
        ))}
      </div>
    </div>
  </section>
</MainLayout>

<style>
  @keyframes fade-in-up {
    from { opacity: 0; transform: translateY(20px); }
    to { opacity: 1; transform: translateY(0); }
  }
  
  @keyframes gradient-x {
    0%, 100% { background-position: 0% 50%; }
    50% { background-position: 100% 50%; }
  }
  
  .animate-gradient-x {
    animation: gradient-x 3s ease infinite;
  }
  
  .animate-pulse-slow {
    animation: pulse 4s ease-in-out infinite;
  }
</style>
