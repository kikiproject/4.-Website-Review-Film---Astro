---
import BaseLayout from '../../layouts/BaseLayout.astro';
import { Icon } from '@iconify/react';

// Mock VTuber data - In production from MySQL
const vtubers = [
  { 
    id: 1, 
    name: "Sakura Hana", 
    username: "sakura_vtuber", 
    email: "sakura@astro.id",
    agency: "ASTRO VTuber", 
    followers: 12500, 
    totalEvents: 23,
    isLive: true, 
    isVerified: true,
    debutDate: "2024-01-15",
    avatar: "https://ui-avatars.com/api/?name=Sakura+Hana&background=8B5CF6&color=fff",
    status: 'active'
  },
  { 
    id: 2, 
    name: "Yuki Shirogane", 
    username: "yuki_vtuber", 
    email: "yuki@astro.id",
    agency: "ASTRO VTuber", 
    followers: 8300, 
    totalEvents: 15,
    isLive: false, 
    isVerified: true,
    debutDate: "2024-03-20",
    avatar: "https://ui-avatars.com/api/?name=Yuki+Shirogane&background=EC4899&color=fff",
    status: 'active'
  },
  { 
    id: 3, 
    name: "Luna Celestia", 
    username: "luna_vtuber", 
    email: "luna@astro.id",
    agency: "ASTRO VTuber", 
    followers: 15200, 
    totalEvents: 31,
    isLive: true, 
    isVerified: true,
    debutDate: "2024-06-01",
    avatar: "https://ui-avatars.com/api/?name=Luna+Celestia&background=6366F1&color=fff",
    status: 'active'
  },
  { 
    id: 4, 
    name: "Miku Aoyama", 
    username: "miku_vtuber", 
    email: "miku@astro.id",
    agency: "Independent", 
    followers: 5100, 
    totalEvents: 8,
    isLive: false, 
    isVerified: true,
    debutDate: "2025-01-10",
    avatar: "https://ui-avatars.com/api/?name=Miku+Aoyama&background=14B8A6&color=fff",
    status: 'active'
  },
];

const stats = {
  totalVtubers: vtubers.length,
  liveNow: vtubers.filter(v => v.isLive).length,
  totalFollowers: vtubers.reduce((sum, v) => sum + v.followers, 0),
  totalEvents: vtubers.reduce((sum, v) => sum + v.totalEvents, 0),
};
---

<BaseLayout title="Kelola VTuber - Admin ASTRO">
  <div class="flex h-screen bg-dark-500">
    <!-- Sidebar (same as dashboard) -->
    <aside class="w-64 bg-dark-400 border-r border-dark-200 flex flex-col fixed h-full z-20">
      <div class="p-6 border-b border-dark-200">
        <a href="/admin" class="flex items-center gap-3">
          <div class="w-10 h-10 bg-gradient-to-br from-primary-500 to-violet-500 rounded-xl flex items-center justify-center">
            <Icon icon="lucide:shield" class="w-6 h-6 text-white" client:load />
          </div>
          <div>
            <span class="font-display font-bold text-xl text-white">ASTRO</span>
            <span class="text-xs text-red-400 block font-medium">Admin Panel</span>
          </div>
        </a>
      </div>

      <nav class="flex-1 p-4 space-y-1 overflow-y-auto">
        <a href="/admin" class="flex items-center gap-3 px-4 py-3 rounded-xl text-secondary-400 hover:bg-dark-300 transition-colors">
          <Icon icon="lucide:layout-dashboard" class="w-5 h-5" client:load />
          Dashboard
        </a>
        <a href="/admin/pengguna" class="flex items-center gap-3 px-4 py-3 rounded-xl text-secondary-400 hover:bg-dark-300 transition-colors">
          <Icon icon="lucide:users" class="w-5 h-5" client:load />
          Kelola Pengguna
        </a>
        <a href="/admin/vtuber" class="flex items-center gap-3 px-4 py-3 rounded-xl bg-violet-500/10 text-violet-400 border-l-2 border-violet-500">
          <Icon icon="mdi:account-star" class="w-5 h-5" client:load />
          Kelola VTuber
        </a>
        <a href="/admin/review" class="flex items-center gap-3 px-4 py-3 rounded-xl text-secondary-400 hover:bg-dark-300 transition-colors">
          <Icon icon="lucide:message-square" class="w-5 h-5" client:load />
          Moderasi Review
        </a>
        <a href="/admin/film" class="flex items-center gap-3 px-4 py-3 rounded-xl text-secondary-400 hover:bg-dark-300 transition-colors">
          <Icon icon="lucide:film" class="w-5 h-5" client:load />
          Kelola Film
        </a>
      </nav>

      <div class="p-4 border-t border-dark-200">
        <div class="flex items-center gap-3">
          <img 
            src="https://ui-avatars.com/api/?name=Admin&background=1A2DE7&color=fff"
            alt="Admin"
            class="w-10 h-10 rounded-full"
          />
          <div class="flex-1 min-w-0">
            <p class="text-white font-medium text-sm truncate">Super Admin</p>
            <p class="text-secondary-400 text-xs truncate">admin@astro.id</p>
          </div>
        </div>
      </div>
    </aside>

    <!-- Main Content -->
    <main class="flex-1 ml-64 overflow-auto">
      <!-- Header -->
      <header class="sticky top-0 z-10 bg-dark-500/95 backdrop-blur-md border-b border-dark-200 px-8 py-4">
        <div class="flex items-center justify-between">
          <div>
            <h1 class="text-2xl font-bold text-white flex items-center gap-2">
              <Icon icon="mdi:account-star" class="w-7 h-7 text-violet-400" client:load />
              Kelola VTuber
            </h1>
            <p class="text-secondary-400 text-sm">Buat dan kelola akun VTuber resmi</p>
          </div>
          <button 
            id="create-vtuber-btn"
            class="px-6 py-3 bg-gradient-to-r from-violet-500 to-pink-500 text-white rounded-xl font-medium hover:shadow-glow-violet transition-all flex items-center gap-2"
          >
            <Icon icon="lucide:plus" class="w-5 h-5" client:load />
            Buat Akun VTuber
          </button>
        </div>
      </header>

      <!-- Content -->
      <div class="p-8">
        <!-- Stats Grid -->
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
          <div class="card p-6 border-violet-500/30">
            <div class="flex items-center gap-4">
              <div class="w-14 h-14 bg-violet-500/20 rounded-2xl flex items-center justify-center">
                <Icon icon="mdi:account-star" class="w-7 h-7 text-violet-400" client:load />
              </div>
              <div>
                <p class="text-3xl font-bold text-white">{stats.totalVtubers}</p>
                <p class="text-secondary-400 text-sm">Total VTuber</p>
              </div>
            </div>
          </div>
          <div class="card p-6">
            <div class="flex items-center gap-4">
              <div class="w-14 h-14 bg-red-500/20 rounded-2xl flex items-center justify-center">
                <Icon icon="lucide:radio" class="w-7 h-7 text-red-400" client:load />
              </div>
              <div>
                <p class="text-3xl font-bold text-white">{stats.liveNow}</p>
                <p class="text-secondary-400 text-sm">Sedang Live</p>
              </div>
            </div>
          </div>
          <div class="card p-6">
            <div class="flex items-center gap-4">
              <div class="w-14 h-14 bg-pink-500/20 rounded-2xl flex items-center justify-center">
                <Icon icon="lucide:users" class="w-7 h-7 text-pink-400" client:load />
              </div>
              <div>
                <p class="text-3xl font-bold text-white">{stats.totalFollowers.toLocaleString()}</p>
                <p class="text-secondary-400 text-sm">Total Followers</p>
              </div>
            </div>
          </div>
          <div class="card p-6">
            <div class="flex items-center gap-4">
              <div class="w-14 h-14 bg-cyan-500/20 rounded-2xl flex items-center justify-center">
                <Icon icon="lucide:tv" class="w-7 h-7 text-cyan-400" client:load />
              </div>
              <div>
                <p class="text-3xl font-bold text-white">{stats.totalEvents}</p>
                <p class="text-secondary-400 text-sm">Total Events</p>
              </div>
            </div>
          </div>
        </div>

        <!-- VTuber Table -->
        <div class="card">
          <div class="p-6 border-b border-dark-200 flex items-center justify-between">
            <h2 class="text-lg font-bold text-white">Daftar VTuber</h2>
            <div class="flex items-center gap-3">
              <div class="relative">
                <input 
                  type="search" 
                  placeholder="Cari VTuber..." 
                  class="input w-64 pl-10"
                />
                <Icon icon="lucide:search" class="w-5 h-5 text-secondary-400 absolute left-3 top-1/2 -translate-y-1/2" client:load />
              </div>
              <select class="input w-40">
                <option value="">Semua Status</option>
                <option value="active">Aktif</option>
                <option value="inactive">Nonaktif</option>
                <option value="live">Sedang Live</option>
              </select>
            </div>
          </div>
          <div class="overflow-x-auto">
            <table class="w-full">
              <thead class="bg-dark-300">
                <tr>
                  <th class="text-left p-4 text-secondary-300 font-medium text-sm">VTuber</th>
                  <th class="text-left p-4 text-secondary-300 font-medium text-sm">Agency</th>
                  <th class="text-left p-4 text-secondary-300 font-medium text-sm">Followers</th>
                  <th class="text-left p-4 text-secondary-300 font-medium text-sm">Events</th>
                  <th class="text-left p-4 text-secondary-300 font-medium text-sm">Debut</th>
                  <th class="text-left p-4 text-secondary-300 font-medium text-sm">Status</th>
                  <th class="text-right p-4 text-secondary-300 font-medium text-sm">Aksi</th>
                </tr>
              </thead>
              <tbody>
                {vtubers.map((vtuber) => (
                  <tr class="border-t border-dark-200 hover:bg-dark-300/50 transition-colors">
                    <td class="p-4">
                      <div class="flex items-center gap-3">
                        <div class="relative">
                          <img src={vtuber.avatar} alt={vtuber.name} class="w-12 h-12 rounded-full ring-2 ring-violet-500" />
                          {vtuber.isLive && (
                            <div class="absolute -bottom-0.5 -right-0.5 w-5 h-5 bg-red-500 rounded-full flex items-center justify-center border-2 border-dark-400">
                              <span class="w-2 h-2 bg-white rounded-full animate-pulse"></span>
                            </div>
                          )}
                        </div>
                        <div>
                          <p class="text-white font-medium flex items-center gap-2">
                            {vtuber.name}
                            {vtuber.isVerified && (
                              <Icon icon="lucide:check-circle" class="w-4 h-4 text-violet-400" client:load />
                            )}
                          </p>
                          <p class="text-secondary-400 text-sm">@{vtuber.username}</p>
                        </div>
                      </div>
                    </td>
                    <td class="p-4 text-secondary-300">{vtuber.agency}</td>
                    <td class="p-4 text-white">{vtuber.followers.toLocaleString()}</td>
                    <td class="p-4 text-secondary-300">{vtuber.totalEvents}</td>
                    <td class="p-4 text-secondary-300">{new Date(vtuber.debutDate).toLocaleDateString('id-ID')}</td>
                    <td class="p-4">
                      {vtuber.isLive ? (
                        <span class="px-3 py-1 bg-red-500 text-white rounded-full text-xs font-bold flex items-center gap-1 w-fit">
                          <span class="w-1.5 h-1.5 bg-white rounded-full animate-pulse"></span>
                          LIVE
                        </span>
                      ) : (
                        <span class="px-3 py-1 bg-green-500/20 text-green-400 rounded-full text-xs font-medium">
                          Aktif
                        </span>
                      )}
                    </td>
                    <td class="p-4 text-right">
                      <div class="flex items-center justify-end gap-2">
                        <button class="p-2 bg-violet-500/20 rounded-lg text-violet-400 hover:bg-violet-500/30 transition-colors" title="Edit">
                          <Icon icon="lucide:edit" class="w-4 h-4" client:load />
                        </button>
                        <button class="p-2 bg-primary-500/20 rounded-lg text-primary-400 hover:bg-primary-500/30 transition-colors" title="Reset Password">
                          <Icon icon="lucide:key" class="w-4 h-4" client:load />
                        </button>
                        <button class="p-2 bg-dark-300 rounded-lg text-secondary-400 hover:text-white transition-colors" title="Lihat Detail">
                          <Icon icon="lucide:eye" class="w-4 h-4" client:load />
                        </button>
                      </div>
                    </td>
                  </tr>
                ))}
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </main>
  </div>

  <!-- Create VTuber Modal -->
  <div id="create-modal" class="fixed inset-0 z-50 hidden items-center justify-center p-4 bg-black/70 backdrop-blur-sm">
    <div class="w-full max-w-lg bg-dark-400 rounded-2xl border border-dark-200 shadow-2xl">
      <div class="p-6 border-b border-dark-200 flex items-center justify-between">
        <h3 class="text-xl font-bold text-white flex items-center gap-2">
          <Icon icon="mdi:account-star" class="w-6 h-6 text-violet-400" client:load />
          Buat Akun VTuber Baru
        </h3>
        <button id="close-modal" class="p-2 hover:bg-dark-300 rounded-lg transition-colors">
          <Icon icon="lucide:x" class="w-5 h-5 text-secondary-400" client:load />
        </button>
      </div>
      <form id="create-vtuber-form" class="p-6 space-y-4">
        <div class="grid grid-cols-2 gap-4">
          <div>
            <label class="block text-sm text-secondary-300 mb-2">Nama VTuber</label>
            <input type="text" name="vtuberName" class="input w-full" placeholder="Sakura Hana" required />
          </div>
          <div>
            <label class="block text-sm text-secondary-300 mb-2">Username</label>
            <input type="text" name="username" class="input w-full" placeholder="sakura_vtuber" required />
          </div>
        </div>
        <div>
          <label class="block text-sm text-secondary-300 mb-2">Email</label>
          <input type="email" name="email" class="input w-full" placeholder="sakura@astro.id" required />
        </div>
        <div>
          <label class="block text-sm text-secondary-300 mb-2">Password</label>
          <input type="password" name="password" class="input w-full" placeholder="Min 8 karakter" required minlength="8" />
        </div>
        <div class="grid grid-cols-2 gap-4">
          <div>
            <label class="block text-sm text-secondary-300 mb-2">Agency</label>
            <input type="text" name="agency" class="input w-full" placeholder="ASTRO VTuber" />
          </div>
          <div>
            <label class="block text-sm text-secondary-300 mb-2">Tanggal Debut</label>
            <input type="date" name="debutDate" class="input w-full" />
          </div>
        </div>
        <div class="flex items-center gap-3 pt-4">
          <button type="submit" class="flex-1 py-3 bg-gradient-to-r from-violet-500 to-pink-500 text-white rounded-xl font-medium hover:shadow-glow-violet transition-all">
            Buat Akun VTuber
          </button>
          <button type="button" id="cancel-modal" class="px-6 py-3 bg-dark-300 text-white rounded-xl font-medium hover:bg-dark-200 transition-colors">
            Batal
          </button>
        </div>
      </form>
    </div>
  </div>
</BaseLayout>

<script>
  const modal = document.getElementById('create-modal');
  const openBtn = document.getElementById('create-vtuber-btn');
  const closeBtn = document.getElementById('close-modal');
  const cancelBtn = document.getElementById('cancel-modal');
  
  openBtn?.addEventListener('click', () => {
    modal?.classList.remove('hidden');
    modal?.classList.add('flex');
  });
  
  const closeModal = () => {
    modal?.classList.add('hidden');
    modal?.classList.remove('flex');
  };
  
  closeBtn?.addEventListener('click', closeModal);
  cancelBtn?.addEventListener('click', closeModal);
  
  modal?.addEventListener('click', (e) => {
    if (e.target === modal) closeModal();
  });
  
  document.getElementById('create-vtuber-form')?.addEventListener('submit', (e) => {
    e.preventDefault();
    // In production, this would send to API
    alert('VTuber account created! (Demo)');
    closeModal();
  });
</script>
